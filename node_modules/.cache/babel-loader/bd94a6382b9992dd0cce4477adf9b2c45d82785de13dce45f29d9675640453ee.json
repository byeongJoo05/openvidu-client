{"ast":null,"code":"\"use strict\";\n\n/*\n * (C) Copyright 2017-2022 OpenVidu (https://openvidu.io)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Filter = void 0;\nvar StreamPropertyChangedEvent_1 = require(\"../OpenViduInternal/Events/StreamPropertyChangedEvent\");\nvar OpenViduError_1 = require(\"../OpenViduInternal/Enums/OpenViduError\");\nvar OpenViduLogger_1 = require(\"../OpenViduInternal/Logger/OpenViduLogger\");\n/**\n * @hidden\n */\nvar logger = OpenViduLogger_1.OpenViduLogger.getInstance();\n/**\n * **WARNING**: experimental option. This interface may change in the near future\n *\n * Video/audio filter applied to a Stream. See {@link Stream.applyFilter}\n */\nvar Filter = /** @class */function () {\n  /**\n   * @hidden\n   */\n  function Filter(type, options) {\n    /**\n     * @hidden\n     */\n    this.handlers = new Map();\n    this.type = type;\n    this.options = options;\n  }\n  /**\n   * Executes a filter method. Available methods are specific for each filter\n   *\n   * @param method Name of the method\n   * @param params Parameters of the method\n   */\n  Filter.prototype.execMethod = function (method, params) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      var _a;\n      logger.info('Executing filter method to stream ' + _this.stream.streamId);\n      var finalParams;\n      var successExecMethod = function successExecMethod(triggerEvent) {\n        logger.info('Filter method successfully executed on Stream ' + _this.stream.streamId);\n        var oldValue = Object.assign({}, _this.stream.filter);\n        _this.stream.filter.lastExecMethod = {\n          method: method,\n          params: finalParams\n        };\n        if (triggerEvent) {\n          _this.stream.session.emitEvent('streamPropertyChanged', [new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.stream.session, _this.stream, 'filter', _this.stream.filter, oldValue, 'execFilterMethod')]);\n          _this.stream.streamManager.emitEvent('streamPropertyChanged', [new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.stream.streamManager, _this.stream, 'filter', _this.stream.filter, oldValue, 'execFilterMethod')]);\n        }\n        return resolve();\n      };\n      if (_this.type.startsWith('VB:')) {\n        if (typeof params === 'string') {\n          try {\n            params = JSON.parse(params);\n          } catch (error) {\n            return reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR, 'Wrong params syntax: ' + error));\n          }\n        }\n        finalParams = params;\n        if (method === 'update') {\n          if (!((_a = _this.stream.virtualBackgroundSinkElements) === null || _a === void 0 ? void 0 : _a.VB)) {\n            return reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR, 'There is no Virtual Background filter applied'));\n          } else {\n            _this.stream.virtualBackgroundSinkElements.VB.updateValues(params).then(function () {\n              return successExecMethod(false);\n            }).catch(function (error) {\n              if (error.name === OpenViduError_1.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR) {\n                return reject(new OpenViduError_1.OpenViduError(error.name, error.message));\n              } else {\n                return reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR, 'Error updating values on Virtual Background filter: ' + error));\n              }\n            });\n          }\n        } else {\n          return reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR, \"Unknown Virtual Background method \\\"\".concat(method, \"\\\"\")));\n        }\n      } else {\n        var stringParams = void 0;\n        if (typeof params !== 'string') {\n          try {\n            stringParams = JSON.stringify(params);\n          } catch (error) {\n            var errorMsg = \"'params' property must be a JSON formatted object\";\n            logger.error(errorMsg);\n            return reject(errorMsg);\n          }\n        } else {\n          stringParams = params;\n        }\n        finalParams = stringParams;\n        _this.stream.session.openvidu.sendRequest('execFilterMethod', {\n          streamId: _this.stream.streamId,\n          method: method,\n          params: stringParams\n        }, function (error, response) {\n          if (error) {\n            logger.error('Error executing filter method for Stream ' + _this.stream.streamId, error);\n            if (error.code === 401) {\n              return reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, \"You don't have permissions to execute a filter method\"));\n            } else {\n              return reject(error);\n            }\n          } else {\n            return successExecMethod(true);\n          }\n        });\n      }\n    });\n  };\n  /**\n   * Subscribe to certain filter event. Available events are specific for each filter\n   *\n   * @param eventType Event to which subscribe to.\n   * @param handler Function to execute upon event dispatched. It receives as parameter a {@link FilterEvent} object\n   *\n   * @returns A Promise (to which you can optionally subscribe to) that is resolved if the event listener was successfully attached to the filter and rejected with an Error object if not\n   */\n  Filter.prototype.addEventListener = function (eventType, handler) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      logger.info('Adding filter event listener to event ' + eventType + ' to stream ' + _this.stream.streamId);\n      _this.stream.session.openvidu.sendRequest('addFilterEventListener', {\n        streamId: _this.stream.streamId,\n        eventType: eventType\n      }, function (error, response) {\n        if (error) {\n          logger.error('Error adding filter event listener to event ' + eventType + 'for Stream ' + _this.stream.streamId, error);\n          if (error.code === 401) {\n            return reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, \"You don't have permissions to add a filter event listener\"));\n          } else {\n            return reject(error);\n          }\n        } else {\n          _this.handlers.set(eventType, handler);\n          logger.info('Filter event listener to event ' + eventType + ' successfully applied on Stream ' + _this.stream.streamId);\n          return resolve();\n        }\n      });\n    });\n  };\n  /**\n   * Removes certain filter event listener previously set.\n   *\n   * @param eventType Event to unsubscribe from.\n   *\n   * @returns A Promise (to which you can optionally subscribe to) that is resolved if the event listener was successfully removed from the filter and rejected with an Error object in other case\n   */\n  Filter.prototype.removeEventListener = function (eventType) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      logger.info('Removing filter event listener to event ' + eventType + ' to stream ' + _this.stream.streamId);\n      _this.stream.session.openvidu.sendRequest('removeFilterEventListener', {\n        streamId: _this.stream.streamId,\n        eventType: eventType\n      }, function (error, response) {\n        if (error) {\n          logger.error('Error removing filter event listener to event ' + eventType + 'for Stream ' + _this.stream.streamId, error);\n          if (error.code === 401) {\n            return reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, \"You don't have permissions to add a filter event listener\"));\n          } else {\n            return reject(error);\n          }\n        } else {\n          _this.handlers.delete(eventType);\n          logger.info('Filter event listener to event ' + eventType + ' successfully removed on Stream ' + _this.stream.streamId);\n          return resolve();\n        }\n      });\n    });\n  };\n  return Filter;\n}();\nexports.Filter = Filter;","map":{"version":3,"mappings":"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","names":["logger","OpenViduLogger_1","getInstance","type","options","Map","Filter","method","params","Promise","resolve","reject","info","_this","stream","streamId","finalParams","successExecMethod","triggerEvent","oldValue","Object","assign","filter","lastExecMethod","session","emitEvent","StreamPropertyChangedEvent_1","streamManager","startsWith","JSON","parse","error","OpenViduError_1","VIRTUAL_BACKGROUND_ERROR","virtualBackgroundSinkElements","VB","updateValues","then","catch","name","message","stringParams","stringify","errorMsg","openvidu","sendRequest","response","code","OPENVIDU_PERMISSION_DENIED","eventType","handler","handlers","set","delete","exports"],"sources":["C:\\Users\\user\\Desktop\\openvidu-client\\node_modules\\openvidu-browser\\src\\OpenVidu\\Filter.ts"],"sourcesContent":["/*\n * (C) Copyright 2017-2022 OpenVidu (https://openvidu.io)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport { Stream } from './Stream';\nimport { FilterEvent } from '../OpenViduInternal/Events/FilterEvent';\nimport { StreamPropertyChangedEvent } from '../OpenViduInternal/Events/StreamPropertyChangedEvent';\nimport { OpenViduError, OpenViduErrorName } from '../OpenViduInternal/Enums/OpenViduError';\nimport { OpenViduLogger } from '../OpenViduInternal/Logger/OpenViduLogger';\n\n/**\n * @hidden\n */\nconst logger: OpenViduLogger = OpenViduLogger.getInstance();\n\n/**\n * **WARNING**: experimental option. This interface may change in the near future\n *\n * Video/audio filter applied to a Stream. See {@link Stream.applyFilter}\n */\nexport class Filter {\n    /**\n     * Type of filter applied. This is the name of the remote class identifying the filter to apply in Kurento Media Server.\n     * For example: `\"FaceOverlayFilter\"`, `\"GStreamerFilter\"`.\n     *\n     * You can get this property in `*.kmd.json` files defining the Kurento filters. For example, for GStreamerFilter that's\n     * [here](https://github.com/Kurento/kms-filters/blob/53a452fac71d61795952e3d2202156c6b00f6d65/src/server/interface/filters.GStreamerFilter.kmd.json#L4)\n     */\n    type: string;\n\n    /**\n     * Parameters used to initialize the filter.\n     * These correspond to the constructor parameters used in the filter in Kurento Media Server (except for `mediaPipeline` parameter, which is never needed).\n     *\n     * For example: for `filter.type = \"GStreamerFilter\"` could be `filter.options = {\"command\": \"videobalance saturation=0.0\"}`\n     *\n     * You can get this property in `*.kmd.json` files defining the Kurento filters. For example, for GStreamerFilter that's\n     * [here](https://github.com/Kurento/kms-filters/blob/53a452fac71d61795952e3d2202156c6b00f6d65/src/server/interface/filters.GStreamerFilter.kmd.json#L13-L31)\n     */\n    options: Object;\n\n    /**\n     * Value passed the last time {@link Filter.execMethod} was called. If `undefined` this method has not been called yet.\n     *\n     * You can use this value to know the current status of any applied filter\n     */\n    lastExecMethod?: {\n        method: string;\n        params: Object;\n    };\n\n    /**\n     * @hidden\n     */\n    handlers: Map<string, (event: FilterEvent) => void> = new Map();\n\n    /**\n     * @hidden\n     */\n    stream: Stream;\n    private logger: OpenViduLogger;\n\n    /**\n     * @hidden\n     */\n    constructor(type: string, options: Object) {\n        this.type = type;\n        this.options = options;\n    }\n\n    /**\n     * Executes a filter method. Available methods are specific for each filter\n     *\n     * @param method Name of the method\n     * @param params Parameters of the method\n     */\n    execMethod(method: string, params: Object): Promise<void> {\n        return new Promise((resolve, reject) => {\n            logger.info('Executing filter method to stream ' + this.stream.streamId);\n\n            let finalParams;\n\n            const successExecMethod = (triggerEvent) => {\n                logger.info('Filter method successfully executed on Stream ' + this.stream.streamId);\n                const oldValue = (<any>Object).assign({}, this.stream.filter);\n                this.stream.filter!.lastExecMethod = { method, params: finalParams };\n                if (triggerEvent) {\n                    this.stream.session.emitEvent('streamPropertyChanged', [\n                        new StreamPropertyChangedEvent(\n                            this.stream.session,\n                            this.stream,\n                            'filter',\n                            this.stream.filter!,\n                            oldValue,\n                            'execFilterMethod'\n                        )\n                    ]);\n                    this.stream.streamManager.emitEvent('streamPropertyChanged', [\n                        new StreamPropertyChangedEvent(\n                            this.stream.streamManager,\n                            this.stream,\n                            'filter',\n                            this.stream.filter!,\n                            oldValue,\n                            'execFilterMethod'\n                        )\n                    ]);\n                }\n                return resolve();\n            };\n\n            if (this.type.startsWith('VB:')) {\n                if (typeof params === 'string') {\n                    try {\n                        params = JSON.parse(params);\n                    } catch (error) {\n                        return reject(new OpenViduError(OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR, 'Wrong params syntax: ' + error));\n                    }\n                }\n\n                finalParams = params;\n\n                if (method === 'update') {\n                    if (!this.stream.virtualBackgroundSinkElements?.VB) {\n                        return reject(\n                            new OpenViduError(OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR, 'There is no Virtual Background filter applied')\n                        );\n                    } else {\n                        this.stream.virtualBackgroundSinkElements.VB.updateValues(params)\n                            .then(() => successExecMethod(false))\n                            .catch((error) => {\n                                if (error.name === OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR) {\n                                    return reject(new OpenViduError(error.name, error.message));\n                                } else {\n                                    return reject(\n                                        new OpenViduError(\n                                            OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,\n                                            'Error updating values on Virtual Background filter: ' + error\n                                        )\n                                    );\n                                }\n                            });\n                    }\n                } else {\n                    return reject(\n                        new OpenViduError(OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR, `Unknown Virtual Background method \"${method}\"`)\n                    );\n                }\n            } else {\n                let stringParams;\n                if (typeof params !== 'string') {\n                    try {\n                        stringParams = JSON.stringify(params);\n                    } catch (error) {\n                        const errorMsg = \"'params' property must be a JSON formatted object\";\n                        logger.error(errorMsg);\n                        return reject(errorMsg);\n                    }\n                } else {\n                    stringParams = <string>params;\n                }\n\n                finalParams = stringParams;\n\n                this.stream.session.openvidu.sendRequest(\n                    'execFilterMethod',\n                    { streamId: this.stream.streamId, method, params: stringParams },\n                    (error, response) => {\n                        if (error) {\n                            logger.error('Error executing filter method for Stream ' + this.stream.streamId, error);\n                            if (error.code === 401) {\n                                return reject(\n                                    new OpenViduError(\n                                        OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,\n                                        \"You don't have permissions to execute a filter method\"\n                                    )\n                                );\n                            } else {\n                                return reject(error);\n                            }\n                        } else {\n                            return successExecMethod(true);\n                        }\n                    }\n                );\n            }\n        });\n    }\n\n    /**\n     * Subscribe to certain filter event. Available events are specific for each filter\n     *\n     * @param eventType Event to which subscribe to.\n     * @param handler Function to execute upon event dispatched. It receives as parameter a {@link FilterEvent} object\n     *\n     * @returns A Promise (to which you can optionally subscribe to) that is resolved if the event listener was successfully attached to the filter and rejected with an Error object if not\n     */\n    addEventListener(eventType: string, handler: (event: FilterEvent) => void): Promise<void> {\n        return new Promise((resolve, reject) => {\n            logger.info('Adding filter event listener to event ' + eventType + ' to stream ' + this.stream.streamId);\n            this.stream.session.openvidu.sendRequest(\n                'addFilterEventListener',\n                { streamId: this.stream.streamId, eventType },\n                (error, response) => {\n                    if (error) {\n                        logger.error(\n                            'Error adding filter event listener to event ' + eventType + 'for Stream ' + this.stream.streamId,\n                            error\n                        );\n                        if (error.code === 401) {\n                            return reject(\n                                new OpenViduError(\n                                    OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,\n                                    \"You don't have permissions to add a filter event listener\"\n                                )\n                            );\n                        } else {\n                            return reject(error);\n                        }\n                    } else {\n                        this.handlers.set(eventType, handler);\n                        logger.info(\n                            'Filter event listener to event ' + eventType + ' successfully applied on Stream ' + this.stream.streamId\n                        );\n                        return resolve();\n                    }\n                }\n            );\n        });\n    }\n\n    /**\n     * Removes certain filter event listener previously set.\n     *\n     * @param eventType Event to unsubscribe from.\n     *\n     * @returns A Promise (to which you can optionally subscribe to) that is resolved if the event listener was successfully removed from the filter and rejected with an Error object in other case\n     */\n    removeEventListener(eventType: string): Promise<void> {\n        return new Promise((resolve, reject) => {\n            logger.info('Removing filter event listener to event ' + eventType + ' to stream ' + this.stream.streamId);\n            this.stream.session.openvidu.sendRequest(\n                'removeFilterEventListener',\n                { streamId: this.stream.streamId, eventType },\n                (error, response) => {\n                    if (error) {\n                        logger.error(\n                            'Error removing filter event listener to event ' + eventType + 'for Stream ' + this.stream.streamId,\n                            error\n                        );\n                        if (error.code === 401) {\n                            return reject(\n                                new OpenViduError(\n                                    OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,\n                                    \"You don't have permissions to add a filter event listener\"\n                                )\n                            );\n                        } else {\n                            return reject(error);\n                        }\n                    } else {\n                        this.handlers.delete(eventType);\n                        logger.info(\n                            'Filter event listener to event ' + eventType + ' successfully removed on Stream ' + this.stream.streamId\n                        );\n                        return resolve();\n                    }\n                }\n            );\n        });\n    }\n}\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}